<% offer.check_status! %>

<div class="notification_or_message <%= if offer.status == 0 then "white" end %>">
  <span class="date right">
    <span class="small_text bold">
     <% if offer.status == 0 %>Offer expires in (<%= time_ago_in_words(offer.created_at + 2.minutes, true) %>) | <% end %>recieved <%= time_ago_in_words(offer.created_at, true) %> ago
    </span>

    <p class="little_bigger padding_bottom">
      <span class="float_right">Offer from: <%= link_to offer.sender.username, offer.sender %></span>
    </p>
    <p class="padding_bottom">
      <% if offer.status == 0 %><span class="right"><%= link_to 'Accept and Buy', accept_textbook_offer_path(offer.textbook, offer), :method => :post, :confirm => "If you accept this offer, you are obliged to carry out this transaction with #{offer.sender.username}" %> | <%= link_to 'Counter Offer', counter_textbook_offer_path(offer.textbook, offer) %> | <%= link_to 'Reject', reject_textbook_offer_path(offer.textbook, offer), :method => :delete, :confirm => "Are you sure you'd like to reject this offer?" %></span><% end %>
    </p>
    <p class="little_bigger">
      <span class="float_right"><b><%= offer.sender.username %></b>'s Location: <b><%= User.location_from_index offer.sender.location %></span></b>
    </p>

  </span>
  <span class="bigger bold"><%= if offer.selling? then "Recieved Sales Offer from #{offer.sender.username}" else "Recieved Purchase Offer from #{offer.sender.username}" end %></span><br/>
  <span class="little_bigger"><%= link_to offer.textbook.title_short, textbook_path(offer.textbook) %></span><br/><br/>
  <% if offer.selling? %>
    <span class="little_bigger"><%= offer.sender.username %>'s Asking Price: <b>    <%= if offer.active? == false then "(not active)" else number_to_currency offer.listing.price end %></b></span><br/> 
  <% else %>
    <span class="little_bigger">Your Asking Price: <b><%= if offer.active? then number_to_currency offer.listing.price else "(not active)" end %></b></span><br/>
  <% end %>

  <span class="little_bigger"><%= offer.sender.username %>'s Offer: <b><%= number_to_currency offer.price %></b></span><br/><br/>

  <span><b>Status: </b><%= if offer.selling? then Offer.status_from_index offer.status, :buying => true else Offer.status_from_index offer.status, :selling => true end %></span><br/>

  <% if offer.message %>
    <br /><b>Message:</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%= offer.message %><br/>
  <% end %>

  <% if offer.active? && offer.listing.description? %>
    <br/><b>Book Description: </b><%= offer.listing.description %>
  <% end %>
</div>
